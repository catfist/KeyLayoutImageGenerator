# 詳細設計書

## 1. 機能概要
- CSV形式の元データから、キーボードのキー配列画像を生成する。
- キーは格子状に配列される。
- キーボード外形（例: 5x3+5x3 など）はオプションで指定可能。

## 2. 入出力仕様
### 入力
- CSVファイル
  - 各行がキーボードの行、各列がキーに対応。
  - 例:
    ```csv
    Esc,F1,F2,F3,F4
    Tab,Q,W,E,R
    Shift,A,S,D,F
    ```
- 外形指定（コマンドライン引数または設定ファイル）
  - 例: `5x3+5x3`（5行3列のブロックが2つ）

### 出力
- キー配列画像（PNG, SVG など）
  - ファイル名例: `layout.png`、`layout.svg`

## 3. 主要クラス・関数
- `KeyLayoutImageGenerator`
  - 役割: 全体の制御、画像生成のメインクラス
  - 主なメソッド:
    - `load_csv(file_path)` : CSVデータの読み込み
    - `parse_shape_option(option_str)` : 外形オプションの解析
    - `generate_layout(data, shape)` : レイアウトデータ生成
    - `render_image(layout, output_path, format)` : 画像描画・保存

- `KeyBlock`
  - 役割: 1ブロック（例: 5x3）の情報を保持
  - 主な属性: 行数、列数、キー情報

- `Key`
  - 役割: 各キーの情報（ラベル、位置など）

## 4. 処理フロー
1. コマンドライン引数・設定ファイルから入力CSVと外形オプションを取得
2. CSVファイルを読み込み、キー配列データを取得
3. 外形オプションを解析し、レイアウト構造を決定
4. レイアウトデータをもとに画像を生成
5. 指定された形式で画像を保存

## 5. 拡張性・オプション設計
- 外形指定の柔軟な拡張（複数ブロック、変則配列など）
- キーごとの色・ラベル・サイズ指定
- 出力フォーマットの追加（SVG, PDF など）
- GUI対応やWebアプリ化も将来的に検討

## 6. エラーハンドリング
- CSVフォーマット不正時の例外処理
- 外形オプションのパース失敗時のエラー表示
- 出力先ファイルの書き込み失敗時の通知

## 7. サンプルコマンド
```sh
python generate.py --input layout.csv --shape "5x3+5x3" --output layout.png
``` 